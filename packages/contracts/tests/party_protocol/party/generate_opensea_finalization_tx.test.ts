import { describe, expect, it } from "vitest";

import { Party, PartyFactory } from "../../../src/index.ts";

describe("generateOpenseaFinalizationTxData", () => {
  const partyAddress = "0x8D38E1D4A879E3EF003da26d7B0Be998cFccfb9e";
  const networkName = "mainnet" as const;

  it("generates finalization calldata for a ListOnOpensea proposal", async () => {
    const party = await Party.create(networkName, partyAddress);
    const partyFactory = new PartyFactory(networkName);
    const { preciousTokens, preciousTokenIds } =
      await partyFactory.fetchPartyCreationData(partyAddress);

    const result = await party.generateOpenseaFinalizationTxData(
      34n,
      preciousTokens,
      preciousTokenIds,
      { toBlock: 24434432n }
    );

    expect(result.to).toBe(partyAddress);

    const expectedData =
      "0xf0689b47000000000000000000000000000000000000000000000000000000000000002200000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000320000000000000000000000000000000000000000000000000000000000000036000000000000000000000000000000000000000000000000000000000000003a000000000000000000000000000000000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000069af375f0000000000000000000000000000000000000000000000000000000000375f00000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001c40000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000e59818589c10000000000000000000000000000000000000000000000000000000000000003f4800000000000000000000000005af0d9827e0c53e4799bb226655a1de152a425a5000000000000000000000000000000000000000000000000000000000000237400000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000140e3c7de45000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000002714711487800000000000000000000000000000000000000000000000000000c3663566a5800000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000a26b00c1f0df003000390027140000faa7190000000000000000000000006426df811c4e223ccb16448f08f42bf2f54e0ade0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000005af0d9827e0c53e4799bb226655a1de152a425a5000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000023740000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000354be74e639675b4226ac491e1ccaac3cdfb89f2b05a8e754bb6e24a6e17bbb92000000000000000000000000c1167130d6a3d589ddd08c20ad69b480b30c4fbc00000000000000000000000000000000000000000000000000000000698cbff70000000000000000000000000000000000000000000000000000000000000000";

    expect(result.data.toLowerCase()).toBe(expectedData.toLowerCase());
  });
});
