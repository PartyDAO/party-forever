import { describe, expect, it } from "vitest";

import { Party, TokenType } from "../../../src/index.ts";

describe("generateDistributionProposalTx", () => {
  const partyAddress = "0x87088b14c02e639453e91b4588611d4042ca1fc0";
  const networkName = "mainnet" as const;

  it("encodes a propose call for an ETH distribution proposal", async () => {
    const party = await Party.create(networkName, partyAddress);

    const result = party.generateDistributionProposalTx(
      { tokenType: TokenType.ETH, amountWei: 250000000000000000n },
      "1705961861",
      "3628800",
      "8"
    );

    expect(result.to).toBe(partyAddress);

    const expectedData =
      "0xa25632fd000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000065aee9850000000000000000000000000000000000000000000000000000000000375f00000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000840000000700000000000000000000000000000000000000000000000003782dace9d900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";

    expect(result.data.toLowerCase()).toBe(expectedData.toLowerCase());
  });

  it("encodes a propose call for an ERC20 distribution proposal", async () => {
    const party = await Party.create(networkName, partyAddress);

    const result = party.generateDistributionProposalTx(
      {
        tokenType: TokenType.ERC20,
        tokenAddress: "0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",
        amountWei: 1n
      },
      "1719350736",
      "3628800",
      "1"
    );

    expect(result.to).toBe(partyAddress);

    const expectedData =
      "0xa25632fd0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000667b35d00000000000000000000000000000000000000000000000000000000000375f00000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000840000000700000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";

    expect(result.data.toLowerCase()).toBe(expectedData.toLowerCase());
  });
});
